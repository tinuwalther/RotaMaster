<!DOCTYPE html>
<html lang="en">

    <!-- Begin Head -->
    <head >
        <meta charset="UTF-8"  /><meta name="author" content="Martin Walther - @tinuwalther"/>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="keywords" content="Pode, FullCalendar, PowerShell, JavaScript"/>
        <meta name="description" content="RotaMaster is a Calendar App based on Pode and PowerShell-APIs"/>
        
        <link rel="stylesheet" href="/assets/bootstrap/bootstrap.min.css"/>
        <link rel="stylesheet" href="/assets/bootstrap/bootstrap-icons/font/bootstrap-icons.min.css"/>
        <link rel="stylesheet" href="/assets/rotamaster/rotamaster.main.css"/>

        <script src="/assets/bootstrap/bootstrap.bundle.min.js"></script>
        <script src="/assets/rotamaster/fullcalendar.main.min.js"></script>
        <script src="/assets/rotamaster/index.global.min.js"></script>
        <script src="/assets/rotamaster/rotamaster.main.js"></script>

        <script>
            let db;

            // Listener for the load event
            window.addEventListener('load', () => {
                getNextYear('/api/year/new'); // Call the API once the page is fully loaded
            });

            // Listener for DOMContentLoaded event
            document.addEventListener('DOMContentLoaded', async function() {

                // Load userCookie and display the username
                const userCookie = getCookie('CurrentUser');
                let username = null;
                if (userCookie) {
                    // console.log(`Name: ${userCookie.name}, Login: ${userCookie.login}, Email: ${userCookie.email}`);
                    try {
                        username = userCookie.name;
                        if (username) {
                            const welcomeElement = document.getElementById('currentUser');
                            if (welcomeElement) {
                                welcomeElement.textContent = `${username}`;
                                document.getElementById('datalistName').value = username;
                            } else {
                                console.error("Element with ID 'welcomeMessage' not found.");
                            }
                        }else{
                            showAlert(`No username found!`);
                        }
                    } catch (error) {
                        showAlert('There is something wrong with the userCookie!');
                        console.log("There is something wrong with the userCookie!" + error);
                    }
                }else{
                    console.log('User cookie not found or invalid');
                    showAlert('User cookie not found or invalid!');
                }

                // Refresh the footer datetime
                const d = new Date();
                document.getElementById('footerDate').textContent = 'Last refresh: ' + d.toLocaleString();

                // Fetch the events from the API (from the SQLite view v_events) and fill the calendar with the events
                const events = await readDBData('/api/event/read/*');
                const holidays = await loadApiData('/api/csv/read');
                let calendarEvents = [];
                calendarEvents = [
                    ...(holidays || []), // Holidays (if available)
                    ...(Array.isArray(events) ? events : [events] || []) // User Events as Array
                ];
                            
                // Fetch the person from the API (from the SQLite table person) and fill the datalist with the person names
                const person = await readDBData('/api/person/read/*');
                const personNames = new Array;
                person.map((item) => {
                    personNames.push(item.fullname);
                });
                if (personNames.length) {
                    fillDatalistOptions('datalistOptions', personNames);
                    fillDropdownOptions('nameDropdownPerson', personNames);
                    fillDropdownOptions('nameDropdownPersonModal', personNames);
                } else {
                    console.error('No person found.');
                }

                // Fetch the absence from the API (from the SQLite table absence) and fill the dropdown with the absence names
                const absence = await readDBData('/api/absence/read/*');
                const absenceNames = new Array;
                absence.map((item) => {
                    absenceNames.push(item.name);
                });
                if (absenceNames.length) {
                    fillDropdownOptions('nameDropdownAbsence', absenceNames);
                    fillDropdownOptions('nameDropdownAbsenceModal', absenceNames);
                } else {
                    console.error('No absence found.');
                }

                // Create a new FullCalendar instance
                let calendarEl = document.getElementById('calendar');
                let calendar = new FullCalendar.Calendar(calendarEl, {
                    // Concatenate the calendarConfig from the rotamaster.js file
                    ...calendarConfig,

                    // Data from the API is fetched and displayed in the calendar
                    events: calendarEvents,

                    // Custom Buttons for the calendar
                    customButtons: {
                        refreshButton: {
                            text: 'Refresh',
                            icon: 'bi bi-arrow-repeat',
                            hint: 'Kalender aktualisieren',
                            click: function() {
                                console.log('DEBUG', 'Refresh the calendar');
                                refreshCalendarData(calendar);
                            }
                        },
                        // Button to export all events as iCalendar (.ics) file
                        exportToIcs: {
                            // Create a Bootstrap-Modal-Instance for multipleEvents and open it
                            text: 'Export Events',
                            click: function() {
                                const exportModal = new bootstrap.Modal(document.getElementById('multipleEvents'), {
                                    keyboard: true
                                });
                                document.getElementById('btnAllEvents').checked = true;
                                document.getElementById('nameDropdownPersonModal').value = '';
                                document.getElementById('nameDropdownAbsenceModal').value = '';
                                document.getElementById('personNameContainer').style.display = 'none';
                                document.getElementById('eventTypeContainer').style.display = 'none';
                                exportModal.show();
                            }
                        },
                        // Button to export person specific events as iCalendar (.ics) file
                        filterEvents: {
                            text: 'My Events',
                            click: async function() {
                                const button = document.querySelector('.fc-filterEvents-button');
                                const holidays = await loadApiData('/api/csv/read');
                                isMyEvents = button.textContent;
                                let currentEvents = [];
                                let calendarEvents = [];

                                if (isMyEvents.includes('My Events')) {
                                    // Export events of the current user
                                    const response = await fetch(`/api/event/read/${username}`);
                                    if (!response.ok) {
                                        throw new Error(`Failed to fetch user events of ${username}`);
                                    }
                                    currentEvents = await response.json();
                                    button.textContent = 'All Events';
                                }else if(isMyEvents.includes('All Events')) {
                                    // Export events of all users
                                    const response = await fetch('/api/event/read/*');
                                    if (!response.ok) {
                                        throw new Error('Failed to fetch user events of all users');
                                    }
                                    currentEvents = await response.json();
                                    button.textContent = 'My Events';
                                }

                                calendarEvents = [
                                    ...(holidays || []), // Holidays (if available)
                                    ...(Array.isArray(currentEvents) ? currentEvents : [currentEvents] || []) // User Events as Array
                                ];

                                calendar.removeAllEvents();
                                calendar.addEventSource(calendarEvents);
                            }
                        }
                    },

                    // This function is called when the view is changed or the date changes
                    datesSet: function(info) {
                        
                        let displayedYear = calcDisplayedYear(info);

                        // Display the year after the Summary text
                        if (displayedYear) {
                            const summaryElement = document.getElementById('eventSummary');
                            summaryElement.textContent = 'Summary ' + displayedYear;
                        } else {
                            // console.log('DEBUG', 'No year found:', displayedYear);
                        }

                        // Call the function and render the table after the page has loaded
                        getEventSummary(calendarEvents, displayedYear).then(summary => {
                            // console.log('DEBUG', 'Calculate summary');
                            renderTable(summary); 
                        });

                        refreshCalendarData(calendar);
                        document.querySelector('.fc-filterEvents-button').textContent = 'My Events';
                    },

                    // This function is called when an event is clicked
                    eventClick: function(info) {
                        // Create a Bootstrap-Modal-Instance for singleEvent and open it
                        const event = info.event;
                        const singleEvent = new bootstrap.Modal(document.getElementById('singleEvent'), {
                            keyboard: true
                        });
                        setModalEventData(event);
                        document.getElementById('btnExportEvent').checked = true;
                        singleEvent.show();

                        const btnExportEvent = document.getElementById('btnExportEvent'); 
                        const btnRemoveEvent = document.getElementById('btnRemoveEvent'); 

                        const singleEventSubmit = document.getElementById('singleEventSubmit'); 
                        singleEventSubmit.onclick = async function() {
                            if (btnExportEvent.checked) {
                                exportCalendarEvents(event, `${event.title}.ics`);
                            } else {
                                if(event.id){
                                    const message = `Event ${event.id}, ${event.title} wirklich löschen?`;
                                    const result = await showConfirm(message);
                                    if (result) {
                                        if(event.title.includes('Pikett')){
                                            // Remove Override form OpsGenie
                                            if(calendarConfig.opsGenie){
                                                const override = {                                    
                                                    scheduleName: calendarConfig.scheduleName,
                                                    rotationName: calendarConfig.rotationName,
                                                    userName: event.extendedProps.email,
                                                    alias: event.extendedProps.alias,
                                                    onCallStart: event.start,
                                                };
                                                console.log('DEBUG', 'Remove Override form OpsGenie', override);
                                                const opsGenieResult = await removeOpsGenieOverride(override);
                                                console.log('DEBUG', 'OpsGenie Override:', opsGenieResult.result);
                                                // showAlert(`OpsGenie Override ${event.extendedProps.alias} ${opsGenieResult.result}`)
                                            }
                                        }
                                        deleteDBData('/api/event/delete', event)
                                        .then(() => {
                                            // Fetch new data and refresh the calendar
                                            refreshCalendarData(calendar);
                                        })
                                        .catch(error => {
                                            console.error('Error deleting event:', error);
                                            showAlert('Fehler beim Löschen des Events, ggf. OpsGenie prüfen!');
                                        });
                                    }
                                }else{
                                    showAlert(`${event.title} kann nicht gelöscht werden!`)
                                }
                            }
                            const singleEventSubmit = bootstrap.Modal.getInstance(document.getElementById('singleEvent'));
                            singleEventSubmit.hide();                        
                        }
                    },

                    // This function is called when an event is selected
                    select: function(info) {

                        // Convert start and end dates to Date objects
                        const eventStartDate = new Date(info.startStr);
                        const eventEndDate = new Date(info.endStr);
                        // console.log('DEBUG', 'Filling data in event form', eventStartDate, eventEndDate);

                        // Subtract one day from the end date because the endDate is not correctly passed from the calendar
                        eventEndDate.setDate(eventEndDate.getDate() - 1);

                        // Create formatted dates in the format yyyy-MM-dd
                        const formattedStartDate = eventStartDate.toISOString().split('T')[0];
                        const formattedEndDate = eventEndDate.toISOString().split('T')[0];
                        // console.log('DEBUG', 'Formatted:', formattedStartDate, formattedEndDate);

                        // Set values in form elements
                        document.getElementById('start').value = formattedStartDate;
                        document.getElementById('end').value = formattedEndDate;
                    },

                    // This function is called when an event is moved
                    eventDrop: async function(info) {
                        if(info.event.id){
                            // Send update to OpsGenie as Override
                            const message = `'${info.event.title}' verschieben nach ${formatDateToShortISOFormat(info.event.start).substring(0,10)}?`;
                            const result = await showConfirm(message);
                            const event = info.event;
                            if (result) {
                                if(event.extendedProps.type === 'Pikett'){
                                    // console.log('DEBUG', 'Pikett', event.extendedProps);
                                    if(calendarConfig.opsGenie){
                                        if(event.extendedProps.alias){
                                            // Update Override in OpsGenie
                                            const override = {                                    
                                                scheduleName: calendarConfig.scheduleName,
                                                rotationName: calendarConfig.rotationName,
                                                userName: event.extendedProps.email,
                                                alias: event.extendedProps.alias,
                                                onCallStart: event.start,
                                                onCallEnd: event.end
                                            };
                                            // console.log('DEBUG', 'Send update to OpsGenie as Override', event);
                                            const updateOverride = await updateOpsGenieOverride(override);
                                            // console.log('DEBUG', 'Update OpsGenie Override:', updateOverride);
                                            // Update the event in the SQLite table event
                                            const updatedEvent = {
                                                id: event.id,
                                                type: event.extendedProps.type,
                                                alias: event.extendedProps.alias,
                                                start: event.start,
                                                end: event.end
                                            };
                                            await updateDBData('/api/event/update', updatedEvent);
                                            refreshCalendarData(calendar);
                                        }else{
                                            console.log('DEBUG', 'Alias empty', event.extendedProps);
                                            showAlert(`'${event.title} von ${formatDateToShortISOFormat(event.start).substring(0,10)} bis ${formatDateToShortISOFormat(event.end).substring(0,10)}'\nBitte im OpsGenie prüfen und ggf. manuell anpassen!`, 'RotaMaster - OpsGenie Alias ist leer!')
                                        }
                                    }
                                }else{
                                    console.log('DEBUG', 'No Pikett', event.extendedProps);
                                    const updatedEvent = {
                                        id: event.id,
                                        type: event.extendedProps.type,
                                        start: event.start,
                                        end: event.end
                                    };
                                    await updateDBData('/api/event/update', updatedEvent);    
                                }
                            } else {
                                info.revert();
                            }
                        }else{
                            info.revert();
                            showAlert(`'${info.event.title}' ist von einem CSV und kann nicht verschoben werden!`)
                        }
                    }
                    
                });

                // Render the calendar
                calendar.render();
                
                // Add the App-Version to the Navbar-Brand
                const pageTitle = `RotaMaster V${calendarConfig.appVersion.substring(0,1)}`;
                const navbarBrandElement = document.getElementById('navbarBrand');
                if (navbarBrandElement) {
                    navbarBrandElement.textContent = pageTitle;
                };

                // Set the title of the page
                document.getElementById('title').textContent = pageTitle;

                // Add an event listener to the start date input field to set the end date to the start date
                document.getElementById('start').addEventListener('change', function() {
                    const startDate = this.value;
                    document.getElementById('end').value = startDate;
                });

                // Add an event listener to the export button for the modal multipleEvents to export the events as iCalendar (.ics) file
                const exportButton = document.getElementById('btnExport');
                exportButton.addEventListener('click', function() {
                    // Get the events from the calendar
                    const events = calendar.getEvents();
                    
                    if (btnAllEvents.checked) {
                        // Export all events as iCalendar (.ics) file
                        exportCalendarEvents(events, 'all-events.ics');
                    } else if (btnPersonEvents.checked) {
                        // Export person specific events as iCalendar (.ics) file
                        const personName = document.getElementById('nameDropdownPersonModal').value.trim();
                        if (personName) {
                            exportFilteredEvents(
                                events,
                                event => {
                                    const [eventPersonName] = event.title.split(' - ');
                                    return eventPersonName.trim().toLowerCase() === personName.toLowerCase();
                                },
                                `${personName}-events.ics`,
                                exportCalendarEvents
                            );
                        } else {
                            showAlert('Bitte geben Sie einen Namen ein.');
                        }
                    } else if (btnTypeOfEvents.checked) {
                        // Export type of events as iCalendar (.ics) file
                        const eventType = document.getElementById('nameDropdownAbsenceModal').value.trim();
                        if (eventType) {
                            exportFilteredEvents(
                                events,
                                event => {
                                    const [, eventTypeName] = event.title.split(' - ');
                                    return eventTypeName && eventTypeName.trim().toLowerCase() === eventType.toLowerCase();
                                },
                                `${eventType}-events.ics`,
                                exportCalendarEvents
                            );
                        } else {
                            showAlert('Bitte geben Sie einen Event-Typ ein.');
                        }
                    }

                    // Hide the modal after the export
                    const exportModal = bootstrap.Modal.getInstance(document.getElementById('multipleEvents'));
                    exportModal.hide();
                });

                // Listener for the radio buttons to show the input field when the corresponding radio button is selected
                const btnAllEvents = document.getElementById('btnAllEvents');
                const btnPersonEvents = document.getElementById('btnPersonEvents');
                const btnTypeOfEvents = document.getElementById('btnTypeOfEvents');
                const personNameContainer = document.getElementById('personNameContainer');
                const eventTypeContainer = document.getElementById('eventTypeContainer');

                // If the button all events is checked, hide the input fields for person name and event type
                btnAllEvents.addEventListener('change', function() {
                    if (btnAllEvents.checked) {
                        personNameContainer.style.display = 'none';
                        eventTypeContainer.style.display = 'none';
                    }
                });
            
                // If the button person events is checked, show the input field for the person name and hide the input field for the event type
                btnPersonEvents.addEventListener('change', function() {
                    if (btnPersonEvents.checked) {
                        personNameContainer.style.display = 'block';
                        eventTypeContainer.style.display = 'none';
                    }
                });
            
                // If the button type of events is checked, show the input field for the event type and hide the input field for the person name
                btnTypeOfEvents.addEventListener('change', function() {
                    if (btnTypeOfEvents.checked) {
                        personNameContainer.style.display = 'none';
                        eventTypeContainer.style.display = 'block';
                    }
                });

                // Add Tooltip to the buttons, timeout is needed to ensure that the buttos are already rendered
                setTimeout(function() {
                    const buttons = [
                        { selector: '.fc-multiMonthYear-button', tooltip: 'Jahressansicht', },
                        { selector: '.fc-dayGridMonth-button', tooltip: 'Monatsansicht' },
                        { selector: '.fc-listMonth-button', tooltip: 'Listenansicht' },
                        { selector: '.fc-exportToIcs-button', tooltip: 'Exportiere alle Kalender-Events als iCalendar (.ics) Datei' },
                        { selector: '.fc-filterEvents-button', tooltip: 'Zeige nur meine Events an' },
                        { selector: '.fc-exportPersonEvents-button', tooltip: 'Exportiere alle Kalender-Events personenspezifisch als iCalendar (.ics) Datei' }
                    ];
                
                    buttons.forEach(button => {
                        const element = document.querySelector(button.selector);
                        if (element) {
                            element.setAttribute('title', button.tooltip);
                        }
                    });
                }, 0);                
                
                // Add an event Listener to the form to prevent the default form submit and to call the API to add the event
                const form = document.querySelector('form');
                form.addEventListener('submit', async function(event) {
                    event.preventDefault(); // Prevent default form submission

                    // Get the form data as an object
                    const data = getFormData(form);
                    if (!data) {
                        showAlert('Bitte füllen Sie alle erforderlichen Felder aus.');
                        return;
                    }

                    // Add the event to the SQLite table event
                    try {
                        // console.log('DEBUG', data.type, data);
                        // Perform the API call using fetch add data
                        // console.log('DEBUG', calendarConfig.opsGenie);
                        if(data.type === 'Pikett'){
                            const username = data.name;
                            // Fetch the current user from the API (from the SQLite table person)
                            const response = await fetch(`/api/person/read/${username}`);
                            if (!response.ok) {
                                throw new Error(`Failed to fetch user ${username}`);
                            }
                            const currentUser = await response.json();
                            if(currentUser){
                                // Create Override in OpsGenie
                                if(calendarConfig.opsGenie){
                                    const override = {                                    
                                        scheduleName: calendarConfig.scheduleName,
                                        rotationName: calendarConfig.rotationName,
                                        userName: currentUser.email,
                                        onCallStart: data.start,
                                        onCallEnd: data.end
                                    };
                                    const opsGenieResult = await createOpsGenieOverride(override);
                                    console.log('DEBUG', 'OpsGenie Override:', opsGenieResult);
                                    if(opsGenieResult){
                                        // showAlert(`OpsGenie Override ${opsGenieResult.data.alias} created`)
                                        // const message = `Override in OpsGenie für ${currentUser.email} als ${opsGenieResult.data.alias} erstellt. Kalender aktualisieren?`;
                                        // const messageResult = await showConfirm(message);
                                        // if (messageResult) {
                                            // Add the event to the SQLite table event
                                            data.alias = opsGenieResult.data.alias;
                                            // console.log('DEBUG', data);
                                            await createDBData('/api/event/create', data, currentUser);
                                        // }
                                    }else{
                                        showAlert(`Fehler beim Erstellen des Override in OpsGenie für ${currentUser.email}`);
                                        throw new Error(`Failed to create Override in OpsGenie for user ${currentUser.email}`);
                                    }
                                }else{
                                    // Add the event to the SQLite table event
                                    data.alias = null;
                                    // console.log('DEBUG', data);
                                    await createDBData('/api/event/create', data, currentUser);
                                }
                            }else{
                                throw new Error(`Failed to create Override in OpsGenie for user ${username}`);
                            }
                        }else{
                            // Add the event to the SQLite table event
                            data.alias = null;
                            // console.log('DEBUG', data);
                            await createDBData('/api/event/create', data, currentUser);
                        }
                    } catch (error) {
                        console.error('Error occurred:', error);
                        showAlert('An error occurred while adding the event.');
                    }
                });

                // Synchronize the dropdown selection with the datalist input field
                eventListenerDropwodn('nameDropdownPerson','datalistName');
            });

        </script>

        <!-- Title and Favicon -->
        <title id="title" >RotaMaster</title><link type="image/x-icon" href="/assets/img/favicon.png" rel="icon"  />

    </head>
    <!-- End Head -->

    <!-- Begin Body -->
    <Body >    
        <Section Id="section"  >

            <!-- Begin NavBar -->
            <nav Class="navbar navbar-expand-sm bg-dark navbar-dark sticky-top"  >
                <div Class="container-fluid"  >
                    <img src="/assets/img/favicon.png" alt="Bootstrap" width="48" height="48">
                    <a Class="navbar-brand" id="navbarBrand" href="/" Target="_self"  >RotaMaster</a>
                    <button Class="navbar-toggler" type="button" title="Navbar" data-bs-toggle="collapse" data-bs-target="#collapsibleNavbar"  >
                        <span Class="navbar-toggler-icon"  ></span>
                    </button>
                    <div Id="collapsibleNavbar" Class="collapse navbar-collapse"  >
                    <ul Class="navbar-nav"  >
                        <!--
                        <li Class="nav-item"  ><a Class="nav-link" href="https://github.com/tinuwalther/" Target="_blank"  >GitLab</a></li>
                        <li Class="nav-item"  ><a Class="nav-link" href="https://www.w3schools.com/html/" Target="_blank"  >HTML</a></li>
                        <li Class="nav-item"  ><a Class="nav-link" href="https://getbootstrap.com/" Target="_blank"  >Bootstrap</a></li>
                        <li Class="nav-item"  ><a Class="nav-link" href="https://fullcalendar.io/" Target="_blank"  >Full calendar</a></li>
                        <li Class="nav-item"  ><a Class="nav-link" href="https://github.com/RamblingCookieMonster/PSSQLite/" Target="_blank"  >PSSQLite</a></li>
                        -->
                        <li Class="nav-item"  ><a Class="nav-link" href="/absence" >Absenzen</a></li>
                        <li Class="nav-item"  ><a Class="nav-link" href="/person"  >Personen</a></li>
                        <li Class="nav-item"  ><a Class="nav-link" href="/about"  >About</a></li>
                        <li Class="nav-item"  ><a Class="nav-link" href="/logout"  >Logoff</a></li>
                    </ul>
                    <span class="navbar-text ms-auto" id="currentUser">
                        <!-- logged-in as Username -->
                    </span>
                    </div>
                </div>
            </nav>
            <!-- End NavBar -->

            <!-- Begin Modal multipleEvents -->
            <div class="modal fade" id="multipleEvents" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h1 class="modal-title fs-5" id="exampleModalLabel">RotaMaster - Export multiple Events</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <p>Events als ICS-Datei herunterladen:</p>

                            <div class="btn-group" role="group" aria-label="Basic radio toggle button group">

                                <div class="form-check radio-spacing radio-dark">
                                    <input class="form-check-input" type="radio" name="flexRadioDefault" id="btnAllEvents" checked>
                                    <label class="form-check-label dark" for="btnExportEvent">Alle Events als ICS-Datei exportieren</label>
                                </div>
                                <div class="form-check radio-spacing radio-dark">
                                    <input class="form-check-input" type="radio" name="flexRadioDefault" id="btnPersonEvents" checked>
                                    <label class="form-check-label dark" for="btnExportEvent">Alle Events einer bestimmten Person als ICS-Datei exportieren</label>
                                </div>
                                <div class="form-check radio-spacing radio-dark">
                                    <input class="form-check-input" type="radio" name="flexRadioDefault" id="btnTypeOfEvents" checked>
                                    <label class="form-check-label dark" for="btnExportEvent">Alle Events eines bestimmten Typs als ICS-Datei exportieren</label>
                                </div>

                            </div>

                            <!-- Inputfeld für den Namen, standardmäßig versteckt -->
                            <div id="personNameContainer" style="display: none; margin-top: 10px;">
                                <select class="form-select" id="nameDropdownPersonModal" name="nameDropdownPersonModal" title="nameDropdownPersonModal">
                                    <option value="">Please select...</option>
                                    <!-- Option values will be filled dynamically by JavaScript -->
                                </select>
                            </div>

                            <!-- Inputfeld für den Event-Typ, standardmäßig versteckt -->
                            <div id="eventTypeContainer" style="display: none; margin-top: 10px;">
                                <select class="form-select" id="nameDropdownAbsenceModal" name="nameDropdownAbsenceModal" title="nameDropdownAbsenceModal"></select>
                                    <!--option selected>Typ der Abwesenheit</option-->
                                </select><br>
                                </div>

                        </div>
                        <div class="modal-footer">
                            <button type="button" id="btnClose" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="button" id="btnExport" class="btn btn-dark">Submit</button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- End Modal multipleEvents -->

            <!-- Begin Modal singleEvent -->
            <div class="modal fade" id="singleEvent" tabindex="-1" aria-labelledby="updateExportEventsLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h1 class="modal-title fs-5" id="updateExportEventTitle">RotaMaster - Single Event</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <p id="singleEvent-id"></p>
                            <p id="singleEvent-title"></p>
                            <p id="singleEvent-date"></p>
                            <p id="singleEvent-other"></p>
                            <div class="btn-group" role="group" aria-label="Basic radio toggle button group">

                                <div class="form-check radio-spacing radio-dark">
                                    <input class="form-check-input" type="radio" name="flexRadioDefault" id="btnExportEvent" checked>
                                    <label class="form-check-label dark" for="btnExportEvent">Event als ICS-Datei exportieren oder</label>
                                </div>
                                <div class="form-check radio-spacing radio-dark">
                                    <input class="form-check-input" type="radio" name="flexRadioDefault" id="btnRemoveEvent">
                                    <label class="form-check-label dark" for="btnRemoveEvent">Event löschen</label>
                                </div>
                            </div>

                        </div>
                        <div class="modal-footer">
                            <button type="button" id="btnClose" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="button" id="singleEventSubmit" class="btn btn-dark">Submit</button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- End Modal singleEvent -->

            <!-- Begin Modal Alert -->
            <div class="modal fade" id="alert" tabindex="-1" aria-labelledby="alertLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h1 class="modal-title fs-5" id="alertTitle">RotaMaster - Alert</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <p id="alertText"></p>
                        </div>
                        <div class="modal-footer">
                            <button type="button" id="btnOk" class="btn btn-dark" data-bs-dismiss="modal">OK</button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- End Modal Alert -->

            <!-- Begin Modal Confirm -->
            <div class="modal fade" id="confirm" tabindex="-1" aria-labelledby="confirmLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h1 class="modal-title fs-5" id="confirmTitle">RotaMaster - Confirm</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <p id="confirmText"></p>
                        </div>
                        <div class="modal-footer">
                            <!-- return false -->
                            <button type="button" id="btnNo" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
                            <!-- return true -->
                            <button type="button" id="btnYes" class="btn btn-dark">Yes</button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- End Modal Confirm -->

            <div Class="Container-fluid">

                <!-- Begin Section Events -->
                <div id="events-log">

                    <!-- Begin Palceholder Form -->
                    <form action="/api/event/new" method="POST" id="eventForm">

                        <h3>Events</h3>

                        <div class="col-auto">

                            <!-- Hide the form -->
                            <input type="hidden" id="request" name="request" value="form"><br>

                            <div class="input-group mb-3">
                                <span class="input-group-text" id="basic-addon1">Name</span>
                                <input class="form-control" list="datalistOptions" id="datalistName" name="name" placeholder="Tippen oder auswählen...">
                                <datalist id="datalistOptions">
                                    <!-- Option values will be filled dynamically by JavaScript function fillDatalistOptions -->
                                </datalist>
                            </div>
                            
                            <!-- Additional dropdown for names -->
                            <div class="input-group mb-3">
                                <select class="form-select" id="nameDropdownPerson" name="nameDropdownPerson" title="nameDropdownPerson">
                                    <option value="">Please select...</option>
                                    <!-- Option values will be filled dynamically by JavaScript function fillDropdownOptions -->
                                </select>
                            </div>

                        </div>

                        <div class="col-auto">
                            <label for="start" class="form-label">Typ der Abwesenheit</label><br>
                            <select class="form-select" size="5" aria-label="Default select example" id="nameDropdownAbsence" name="type" title="nameDropdownAbsence">
                                <!-- Option values will be filled dynamically by JavaScript function fillDropdownOptions -->
                            </select><br>
                        </div>

                        <label for="start" class="form-label">Startdatum und Enddatum wählen</label><br>
                        <div class="input-group mb-3">
                            <input type="date" class="form-control" id="start" name="start"><br>
                            <input type="date" class="form-control" id="end" name="end"><br>
                        </div>

                        <div class="col-auto">
                            <input type="submit" value="Eintragen" class="btn btn-dark mb-3">
                        </div>
                    </form>
                    <!-- End Form -->

                    <!-- Begin Palceholder Summary -->
                    <div>
                        <h3 id="eventSummary"><!-- Add the current year --></h3>
                        <p>Angaben in ganzen Tagen</p>
                        <!-- Table to show the event data -->
                        <table class="table table-striped table-hover table-sm" id="pikettTable" border="0">
                            <thead>
                                <tr>
                                    <th>Person</th>
                                    <th>Pikett</th>
                                    <th>Peer</th>
                                    <th>Ferien</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Add the event records dynamically -->
                            </tbody>
                        </table>
                    </div>
                    <!-- End Summary -->

                </div>
                <!-- End Events -->

                <!-- Begin Palceholder Calendar -->
                <div id="calendar"></div>
                <!-- End Calendar -->

            </div>

        </Section>

        <pre Style="text-align:center;color:#000"  >Creates the swiss-public holidays for the given year: I ♥ PS > Invoke-WebRequest -Uri http://localhost:8080/api/year/new -Method Post -Body 2025</pre>

    </Body>
    <!-- End Body -->
 
    <!-- Begin Footer -->
    <footer>
        <div Class="container-fluid"  >

            <div Class="row align-items-center"  >

                <div Class="col-md"  >
                    <p Style="color:#f8f9fa">
                        <a Class="btn-sm btn btn-outline-success" href="#" Target="_self"  >TOP</a>
                    </p>
                </div>
                    
                <div Class="col-md"  >
                    <p Style="color:#f8f9fa">
                        Based on <a href="https://www.powershellgallery.com/packages/Pode" Target="_blank"  >Pode</a>
                    </p>
                </div>

                <div Class="col-md" Style="color:#000"  >
                    <p id="footerDate" Style="color:#f8f9fa">
                        <!-- Hier wird der aktuelle TimeStamp eingefügt -->
                    </p>
                </div>

            </div>

        </div>
    </footer>
    <!--End Footer -->

</html>
